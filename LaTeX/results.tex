\section{Results and conclusions}
\setlength{\abovecaptionskip}{0pt plus 0pt minus 2pt}

% 1 page
% Table with different experimental setups, file size, payload on diff setups (2048 byte on localhost, 1467 byte on WiFi and Net due to MTU), header size (32 seed + 8 block_ID bit), ACK size (32 packets needed + 8 block_ID bit). 

% time to decode NET_localhost (last column) - x axis N-K, different lines for each K

% 3 pages
% localhost: goodput, efficiency with PER on x axis K 1000 3500 5500, 3 plot per row, 2 rows
In our experiments to evaluate the performances of the system we have considered the following setups
\begin{center}
\begin{tabular}{ccccccc}

\toprule
scenario&file size (MB)& payload (byte) &header  (bit) &ACK size (bit)&min timeout\\
& & &size seed + block\_ID&pcks + block\_ID& before RTX (ms) \\
\midrule
loc. aggressive&46.2&2048&32 + 8&32 + 8&1\\
loc. efficient&46.2&2048&32 + 8&32 + 8&100\\
WiFi&46.2&1467&32 + 8&32 + 8&100\\
Network&46.2&1467&32 + 8&32 + 8&100\\
\bottomrule
\end{tabular}
\captionof{table}{Experimental setups}
\end{center}
The transmission over the network has been carried out from Padova to Lausanne using UDP packets. \emph{pcks} gives the number of packets that are still needed to decode the block, and the payload size of WiFi and network is dictated by the MTU size. \\
In all these regimes we consider a redundancy for which the porbability of decoding failures (i.e. the receiver correctly receives N packets, but they are not sufficient to decodode the K informative packets) is very low (typically $<10^{-3}$), and therefore negligible. \\
The first very important tradeoff is between decoding time and transmission time as a function of the redundancy, which translates in most of the cases in a tradeoff between goodput and efficieny. In fact, for a fixed K and PER, adding redundancy decreases the time to decode, but it also increases the time to transmit the file (because each packet is bigger, and their number is the same). This tradeoff is very well shown in Figures \ref{fig:goodput_aggr} and \ref{fig:efficiency_aggr}, which show the performance obtained in localhost with an aggressive ARQ (i.e. low timeout before retrasmission). First of all we remark that the goodput decreases approximatively linearly with the packet error probability. Moreover, for K small, adding redundancy decreases the goodput. In fact for K small decoding time prevails over transmissions time (we are in localhost, therefore transmission time is always quite small), and since the time to decode decreases when redundancy increases, by adding redundancy we decode faster and the time to receive and decode the whole file decreases. Hence, the goodput increases. On the other hand, if we increase K, the time to transmit the file has more impact than the time to decode it, and therefore it is better to choose low redundancy in order to transmit faster (clearly up to some limits, under which we also start observing decoding failures).\\
We also observe that goodput decreases with K. In fact in general in localhost, since transmission time is small, for a fixed redundancy, increasing K allows to marginally improve the time to transmit (lesser packets to transmit), while it significantly increases the time to decode. \\
However the efficiency, i.e. the ratio between informative and sent packets, always decreases with redundancy (since we are not taking into account the time to transmit the packets).\\

\begin{figure}[t]
\centering
\begin{subfigure}{0.24\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/localhost_goodput_1000.tex}
	\caption{$K=1000$}
	\label{fig:lh_good_1000}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/localhost_goodput_3500.tex}
	\caption{$K=3500$}
	\label{fig:lh_good_3500}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/localhost_goodput_5500.tex}
	\caption{$K=5500$}
	\label{fig:lh_good_5500}
\end{subfigure}
\caption{Goodput for $K \in \{1000, 3500, 5500\}$ in localhost, aggressive setup}
\label{fig:goodput_aggr}
\end{figure}

\begin{figure}[t]
\centering
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/localhost_efficiency_1000.tex}
	\caption{$K=1000$}
	\label{fig:lh_eff_1000}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/localhost_efficiency_3500.tex}
	\caption{$K=3500$}
	\label{fig:lh_eff_3500}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/localhost_efficiency_5500.tex}
	\caption{$K=5500$}
	\label{fig:lh_eff_5500}
\end{subfigure}
\caption{Efficiency for $K \in \{1000, 3500, 5500\}$ in localhost, aggressive setup}
\label{fig:efficiency_aggr}
\end{figure}

% TODO NET_localhost: goodput, efficiency with PER on x axis K 1000 3500 5500, 3 plot per row, 2 rows
% Relation between different parameters (K, N) and goodput/efficiency. Tradeoff redundancy goodput time to decode.
% Compare the two setup and show the tradeoff between goodput and efficiency, according to the different timeout settings.
% Something on useless packets (i.e. packets that arrive after the completion of a decoding attempt, that may be sent after 
% the reception of previous ACKs), notice that they tend to 0.

\begin{figure}[t]
\centering
\begin{subfigure}{0.24\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	%\input{./figures/localhost_goodput_1000.tex}
	\caption{$K=1000$}
	\label{fig:lh_good_1000_eff}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	%\input{./figures/localhost_goodput_3500.tex}
	\caption{$K=3500$}
	\label{fig:lh_good_3500_eff}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	%\input{./figures/localhost_goodput_5500.tex}
	\caption{$K=5500$}
	\label{fig:lh_good_5500_eff}
\end{subfigure}
\caption{Goodput for $K \in \{1000, 3500, 5500\}$ in localhost, efficiency oriented setup}
\label{fig:goodput_nonaggr}
\end{figure}

\begin{figure}[t]
\centering
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	%\input{./figures/localhost_efficiency_1000.tex}
	\caption{$K=1000$}
	\label{fig:lh_eff_1000_eff}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	%\input{./figures/localhost_efficiency_3500.tex}
	\caption{$K=3500$}
	\label{fig:lh_eff_3500_eff}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	%\input{./figures/localhost_efficiency_5500.tex}
	\caption{$K=5500$}
	\label{fig:lh_eff_5500_eff}
\end{subfigure}
\caption{Efficiency for $K \in \{1000, 3500, 5500\}$ in localhost, efficiency oriented setup}
\label{fig:eff_nonaggr}
\end{figure}


% 3 pages
% wifi: goodput and efficiency, with x axis with N - K, also throughput, show that for N-K small the decoding time is more significant than rx time. 
Again, in Fig. \ref{fig:wifi} we see the tradeoff between goodput and efficiency. Efficiency is always monotonic with respect to redundancy, whereas the behaviour of the goodput is more complicated, and depends on which between the transmission time and the decoding time prevails. In particular we see that gooput increases dramatically for high K when we pass from a redundancy of 1000 to a redundancy of 1500. This, again, is due to the fact that too little redundacy (in ratio with respect to K) yields longer decoding times, which can dominate over the transmission time, and therefore degradate the performances. This explains the peak at $N-K=1500$ for high K: for lower redundancy performance is dictated by decoding time (which increases as redundancy decreases), whereas for higher redundancy performance depends mainly on transmission time (which increases as redundancy increases, since we have more packets to transmit). Therefore goodput depends both on an increasing and decreasing function with respect to redundacy, which explains the non-monotonicity.  We also remark that clearly throughput increases with redundancy, since we reduce the time to decode, whereas the time to transmit the single packets doesn't change very much (if the transmission rate of the packet is high enough, which is the case for WiFi g which is approximately 50 Mbit/s). This is confirmed by the fact that the increase in throughtput is greater for low K, because we are adding in percentage more redundacy, which greatly increase the decoding time. 
\begin{figure}[t]
\centering
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_eff.tex}
	\caption{Efficiency}
	\label{fig:wifi_eff}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_goodput.tex}
	\caption{Goodput}
	\label{fig:wifi_good}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_throughput.tex}
	\caption{Throughput}
	\label{fig:wifi_thr}
\end{subfigure}
\caption{Metrics for WiFi simulation}
\label{fig:wifi}
\end{figure}
% K = 4500, possibly others, show the difference between a nice setting and a low snr setting
In Figures \ref{fig:wifi_lsnr_3500} and \ref{fig:wifi_lsnr_4500} we show the experimental results obtained using WiFi in a high SNR scenario () and low SNR scenario() for two different values of K. Even though experimental measurements show quite a large variance (as can be noted by observing the interval of confidence), it appears quite clearly that, as expected, in the high SNR scenario we obtain better performances with respect to the low SNR case. However measurement uncertainties do not allow to draw further and more precise conclusions (even though we can assume that the qualitative behaviour does not differ very much from the other cases, and the same considerations apply).
\begin{figure}[t]
\centering
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_eff_lsnr_3500.tex}
	\caption{Efficiency}
	\label{fig:wifi_eff_lsnr_3500}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_goodput_lsnr_3500.tex}
	\caption{Goodput}
	\label{fig:wifi_good_lsnr_3500}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_throughput_lsnr_3500.tex}
	\caption{Throughput}
	\label{fig:wifi_thr_lsnr_3500}
\end{subfigure}
\caption{Comparison between setup with good SNR and setup with bad SNR, for $K=3500$}
\label{fig:wifi_lsnr_3500}
\end{figure}
\begin{figure}[t]
\centering
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_eff_lsnr_4500.tex}
	\caption{Efficiency}
	\label{fig:wifi_eff_lsnr_4500}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_goodput_lsnr_4500.tex}
	\caption{Goodput}
	\label{fig:wifi_good_lsnr_4500}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/wifi_throughput_lsnr_4500.tex}
	\caption{Throughput}
	\label{fig:wifi_thr_lsnr_4500}
\end{subfigure}
\caption{Comparison between setup with good SNR and setup with bad SNR, for $K=4500$}
\label{fig:wifi_lsnr_4500}
\end{figure}
% few words on MTU


Fig. \ref{fig:net} show the results of packet transmission between Padova and Lausanne. Also here we see the same qualitative behaviour of the other cases. In particular we remark the crossing of the goodput curves for K=3500 and K=4500 due to the fact that when redundancy is too small, the time to decode a block increases significantly and impacts on the performances (even though less with respect to the WiFi scenario since in this scenario the transmission time is higher, since we have to transmit a packet through a network of 12 hops).
% net: goodput and efficiency, with x axis with N - K, also throughput, show that for N-K small the decoding time is more significant than rx time. 
\begin{figure}[t]
\centering
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/net_eff.tex}
	\caption{Efficiency}
	\label{fig:net_eff}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/net_goodput.tex}
	\caption{Goodput}
	\label{fig:net_good}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/net_throughput.tex}
	\caption{Throughput}
	\label{fig:net_thr}
\end{subfigure}
\caption{Metrics for Net simulation}
\label{fig:net}
\end{figure}

% comparison between RF and LT in localhost
% TODO decoding time comparison
\begin{figure}[t]
\centering
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/localhost_eff_LT3500_RF.tex}
	\caption{Efficiency}
	\label{fig:RF_eff}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	\input{./figures/localhost_goodput_LT3500_RF.tex}
	\caption{Goodput}
	\label{fig:RF_good}
\end{subfigure}\hspace{2em}%
\begin{subfigure}{0.23\textwidth}
	\captionsetup{justification=centering,font=scriptsize}
	\centering
	\setlength\fwidth{\textwidth}
	\setlength\fheight{140}
	%\input{./figures/net_throughput.tex}
	\caption{Decoding time per packet}
	\label{fig:RFLT_dectime}
\end{subfigure}
\caption{Comparison between LT, $K=3500$ - $N=4500$, and RF, $K=12$ - $N=17$}
\label{fig:RFLT}
\end{figure}